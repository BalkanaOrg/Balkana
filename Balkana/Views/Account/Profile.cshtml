@model Balkana.Models.Accounts.UserProfileViewModel
@{
    ViewData["Title"] = "Profile";
    Layout = "_Layout";
}

<link rel="stylesheet" href="~/css/user-profile.css" />

<div class="profile-container">
    <!-- Search Users Section -->
    @if (Model.IsCurrentUser)
    {
        <div class="search-users-top">
            <div class="search-container">
                <h3><i class="fi fi-rr-search"></i> Find Other Users</h3>
                <form asp-action="SearchUsers" method="get" class="search-form-top">
                    <div class="search-input-group">
                        <input name="SearchTerm" type="text" placeholder="Search by username, name, or email..." class="search-input-wide" />
                        <button type="submit" class="search-btn">
                            <i class="fi fi-rr-search"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    }

    <!-- Profile Header -->
    <div class="profile-header">
        <div class="profile-background">
            <div class="background-overlay"></div>
        </div>
        <div class="profile-content">
            <div class="profile-avatar-section">
                <div class="profile-avatar">
                    <img src="@(Model.ProfilePictureUrl ?? "https://i.imgur.com/ZizgQGH.png")" 
                         alt="Profile Picture" 
                         class="avatar-image" />
                </div>
                <div class="profile-badge">
                    <i class="fi fi-rr-user"></i>
                </div>
            </div>
            
            <div class="profile-info">
                <h1 class="profile-name">@Model.FirstName @Model.LastName</h1>
                <p class="profile-username">@@@Model.Username</p>
                <p class="profile-location">
                    <i class="fi fi-rr-marker"></i>
                    @Model.Nationality?.Name
                </p>
                <div class="profile-stats">
                    <div class="stat-item">
                        <span class="stat-value">@Model.UserStatus</span>
                        <span class="stat-label">Status</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Navigation -->
    <div class="profile-nav">
        <div class="nav-container">
            <button class="nav-btn active" data-tab="overview">
                <i class="fi fi-rr-user"></i>
                Overview
            </button>
            @if (Model.HasPlayerProfile)
            {
                <button class="nav-btn" data-tab="trophies">
                    <i class="fi fi-rr-trophy"></i>
                    Trophies
                </button>
            }
            @if (Model.IsCurrentUser)
            {
                <button class="nav-btn" data-tab="settings">
                    <i class="fi fi-rr-settings"></i>
                    Settings
                </button>
            }
        </div>
    </div>

    <!-- Profile Content -->
    <div class="profile-content-area">
        <!-- Overview Tab -->
        <div class="tab-content active" id="overview">
            <div class="content-grid">
                <div class="info-card">
                    <div class="card-header">
                        <h3><i class="fi fi-rr-info"></i> Personal Information</h3>
                    </div>
                    <div class="card-content">
                        <div class="info-row">
                            <span class="info-label">Full Name</span>
                            <span class="info-value">@Model.FirstName @Model.LastName</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Username</span>
                            <span class="info-value">@Model.Username</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Email</span>
                            <span class="info-value">@Model.Email</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Nationality</span>
                            <span class="info-value">@Model.Nationality?.Name</span>
                        </div>
                        @if (Model.HasPlayerProfile)
                        {
                            <div class="info-row">
                                <span class="info-label">Player Profile</span>
                                <span class="info-value">@Model.Player.Nickname</span>
                            </div>
                        }
                    </div>
                </div>

                @if (Model.HasPlayerProfile)
                {
                    <div class="info-card">
                        <div class="card-header">
                            <h3><i class="fi fi-rr-gamepad"></i> Player Information</h3>
                        </div>
                        <div class="card-content">
                            <div class="player-profile-link">
                                <a asp-controller="Players" asp-action="Profile" asp-route-id="@Model.Player.Id" class="player-link-btn">
                                    <i class="fi fi-rr-eye"></i>
                                    View Player Profile
                                </a>
                            </div>
                        </div>
                    </div>
                }

            </div>
        </div>

        <!-- Trophies Tab -->
        @if (Model.HasPlayerProfile)
        {
            <div class="tab-content" id="trophies">
                <div class="trophies-section">
                    <div class="section-header">
                        <h2><i class="fi fi-rr-trophy"></i> Player Trophies</h2>
                        <p>Achievements and tournament victories</p>
                    </div>
                    
                    @if (Model.Player?.PlayerTrophies?.Any() == true)
                    {
                        <div class="trophies-grid">
                            @foreach (var trophy in Model.Player.PlayerTrophies)
                            {
                                <div class="trophy-card">
                                    <div class="trophy-icon">
                                        <i class="fi fi-rr-trophy"></i>
                                    </div>
                                    <div class="trophy-info">
                                        <h4>@trophy.Trophy?.Name</h4>
                                        <p>@trophy.Trophy?.Description</p>
                                        <span class="trophy-date">@trophy.DateAwarded.ToString("MMMM yyyy")</span>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="empty-state">
                            <i class="fi fi-rr-trophy"></i>
                            <h3>No trophies yet</h3>
                            <p>Start competing in tournaments to earn your first trophy!</p>
                        </div>
                    }
                </div>
            </div>
        }

        <!-- Settings Tab -->
        @if (Model.IsCurrentUser)
        {
            <div class="tab-content" id="settings">
                <div class="settings-section">
                    <div class="section-header">
                        <h2><i class="fi fi-rr-settings"></i> Account Settings</h2>
                        <p>Manage your account preferences and security</p>
                    </div>
                    
                    <div class="settings-grid">
                        <div class="setting-card">
                            <div class="setting-icon">
                                <i class="fi fi-rr-user"></i>
                            </div>
                            <div class="setting-content">
                                <h4>Profile Information</h4>
                                <p>Update your personal details and preferences</p>
                                <a asp-action="EditProfile" class="setting-btn">
                                    <i class="fi fi-rr-edit"></i>
                                    Edit Profile
                                </a>
                            </div>
                        </div>

                        <div class="setting-card">
                            <div class="setting-icon">
                                <i class="fi fi-rr-lock"></i>
                            </div>
                            <div class="setting-content">
                                <h4>Change Password</h4>
                                <p>Update your account password for better security</p>
                                <a asp-action="ChangePassword" class="setting-btn">
                                    <i class="fi fi-rr-key"></i>
                                    Change Password
                                </a>
                            </div>
                        </div>

                        <div class="setting-card">
                            <div class="setting-icon">
                                <i class="fi fi-rr-camera"></i>
                            </div>
                            <div class="setting-content">
                                <h4>Profile Picture</h4>
                                <p>Upload a new profile picture</p>
                                <a asp-action="UploadProfilePicture" class="setting-btn">
                                    <i class="fi fi-rr-upload"></i>
                                    Upload Picture
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Linked Accounts Section -->
                    <div class="linked-accounts-section" style="margin-top: 2rem;">
                        <div class="section-header">
                            <h3><i class="fi fi-rr-link"></i> Linked Accounts</h3>
                            <p>Connect your gaming and social media accounts</p>
                        </div>

                        <div class="settings-grid linked-accounts-grid">
                            <!-- Discord -->
                            @{
                                var discordLink = Model.LinkedAccounts?.FirstOrDefault(la => la.Type == "Discord");
                            }
                            <div class="setting-card linked-account-card">
                                <div class="setting-icon">
                                    <i class="fi fi-brands-discord"></i>
                                </div>
                                <div class="setting-content">
                                    <div class="setting-title-row">
                                        <h4>Discord</h4>
                                        <span class="account-status @(discordLink != null ? "linked" : "not-linked")">
                                            @(discordLink != null ? "Linked" : "Not Linked")
                                        </span>
                                    </div>
                                    @if (discordLink != null)
                                    {
                                        <p class="account-detail">ID: @discordLink.Identifier</p>
                                        <div class="setting-actions">
                                            <form asp-action="UnlinkAccount" method="post" class="inline-form">
                                                <input type="hidden" name="type" value="Discord" />
                                                @Html.AntiForgeryToken()
                                                <button type="submit" class="ghost-btn">
                                                    <i class="fi fi-rr-unlink"></i>
                                                    Unlink
                                                </button>
                                            </form>
                                        </div>
                                    }
                                    else
                                    {
                                        <p class="account-detail muted">Connect your Discord account to show your community status.</p>
                                        <div class="setting-actions">
                                            <a asp-action="LinkDiscord" class="setting-btn subtle">
                                                <i class="fi fi-rr-link"></i>
                                                Link Discord
                                            </a>
                                        </div>
                                    }
                                </div>
                            </div>

                            <!-- FaceIt -->
                            @{
                                var faceItLink = Model.LinkedAccounts?.FirstOrDefault(la => la.Type == "FaceIt");
                            }
                            <div class="setting-card linked-account-card">
                                <div class="setting-icon">
                                    <i class="fi fi-rr-gamepad"></i>
                                </div>
                                <div class="setting-content">
                                    <div class="setting-title-row">
                                        <h4>FaceIt</h4>
                                        <span class="account-status @(faceItLink != null ? "linked" : "not-linked")">
                                            @(faceItLink != null ? "Linked" : "Not Linked")
                                        </span>
                                    </div>
                                    @if (faceItLink != null)
                                    {
                                        <p class="account-detail">UUID: @faceItLink.Identifier</p>
                                        <div class="setting-actions">
                                            <form asp-action="UnlinkAccount" method="post" class="inline-form">
                                                <input type="hidden" name="type" value="FaceIt" />
                                                @Html.AntiForgeryToken()
                                                <button type="submit" class="ghost-btn">
                                                    <i class="fi fi-rr-unlink"></i>
                                                    Unlink
                                                </button>
                                            </form>
                                        </div>
                                    }
                                    else
                                    {
                                        <p class="account-detail muted">Link FaceIt to showcase your competitive profile.</p>
                                        <div class="setting-actions">
                                            <a asp-action="LinkFaceIt" class="setting-btn subtle">
                                                <i class="fi fi-rr-link"></i>
                                                Link FaceIt
                                            </a>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>

                        <!-- Social Media Links -->
                        <div class="social-media-section" style="margin-top: 2rem;">
                            <div class="section-header">
                                <h3><i class="fi fi-rr-share"></i> Social Media Links</h3>
                                <p>Add your social media profiles</p>
                            </div>

                            <div class="settings-grid social-accounts-grid">
                                @{
                                    var socialTypes = new[] { "Instagram", "Facebook", "YouTube", "Twitch", "Twitter", "TikTok", "LinkedIn" };
                                    var socialIcons = new Dictionary<string, string>
                                    {
                                        { "Instagram", "fi-brands-instagram" },
                                        { "Facebook", "fi-brands-facebook" },
                                        { "YouTube", "fi-brands-youtube" },
                                        { "Twitch", "fi-brands-twitch" },
                                        { "Twitter", "fi-brands-twitter" },
                                        { "TikTok", "fi-brands-tiktok" },
                                        { "LinkedIn", "fi-brands-linkedin" }
                                    };
                                }

                                @foreach (var socialType in socialTypes)
                                {
                                    var socialLink = Model.LinkedAccounts?.FirstOrDefault(la => la.Type == socialType);
                                    var iconClass = socialIcons.ContainsKey(socialType) ? socialIcons[socialType] : "fi-rr-link";
                                    
                                    <div class="setting-card social-account-card">
                                        <div class="setting-icon">
                                            <i class="fi @iconClass"></i>
                                        </div>
                                        <div class="setting-content">
                                            <div class="setting-title-row">
                                                <h4>@socialType</h4>
                                                <span class="account-status @(socialLink != null ? "linked" : "not-linked")">
                                                    @(socialLink != null ? "Linked" : "Not Linked")
                                                </span>
                                            </div>
                                            @if (socialLink != null)
                                            {
                                                <p class="account-detail">@socialLink.Identifier</p>
                                                <div class="setting-actions">
                                                    <form asp-action="UnlinkAccount" method="post" class="inline-form">
                                                        <input type="hidden" name="type" value="@socialType" />
                                                        @Html.AntiForgeryToken()
                                                        <button type="submit" class="ghost-btn">
                                                            <i class="fi fi-rr-unlink"></i>
                                                            Remove
                                                        </button>
                                                    </form>
                                                </div>
                                            }
                                            else
                                            {
                                                <p class="account-detail muted">Add your @socialType handle so fans can follow you.</p>
                                                <form asp-action="LinkSocialMedia" method="post" class="social-link-form">
                                                    @Html.AntiForgeryToken()
                                                    <input type="hidden" name="type" value="@socialType" />
                                                    <input type="text" name="identifier" placeholder="@socialType username or URL" class="social-input" required />
                                                    <button type="submit" class="setting-btn subtle">
                                                        <i class="fi fi-rr-link"></i>
                                                        Add
                                                    </button>
                                                </form>
                                            }
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        // Tab switching functionality
        document.addEventListener('DOMContentLoaded', function() {
            const navBtns = document.querySelectorAll('.nav-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            navBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remove active class from all nav buttons and tab contents
                    navBtns.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(t => t.classList.remove('active'));
                    
                    // Add active class to clicked button and corresponding tab
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });
        });
    </script>
}
